const Subjects = [
  [
    //OOP
    {
      name: "Object oriented programming",
      teacher: "Khuyagbaatar",
      day: "Tuesday",
      startTime: "12:40",
      endTime: "14:10",
      type: "Lecture",
    },
    {
      name: "Object oriented programming",
      teacher: "Khuyagbaatar",
      day: "Friday",
      startTime: "11:00",
      endTime: "13:25",
      type: "Laboratory",
    },
    {
      name: "Object oriented programming",
      teacher: "Khuyagbaatar",
      day: "Friday",
      startTime: "13:25",
      endTime: "15:50",
      type: "Laboratory",
    },
    {
      name: "Object oriented programming",
      teacher: "Zoljargal",
      day: "Monday",
      startTime: "14:20",
      endTime: "15:50",
      type: "Lecture",
    },
    {
      name: "Object oriented programming",
      teacher: "Zoljargal",
      day: "Monday",
      startTime: "16:45",
      endTime: "19:10",
      type: "Laboratory",
    },
    {
      name: "Object oriented programming",
      teacher: "Zoljargal",
      day: "Tuesday",
      startTime: "07:40",
      endTime: "10:05",
      type: "Laboratory",
    },
  ],
  [
    //Algorithmiin undes
    {
      name: "Algorithmiin undes",
      teacher: "Nanzadragchaa",
      day: "Monday",
      startTime: "07:40",
      endTime: "09:10",
      type: "Lecture",
    },
    {
      name: "Algorithmiin undes",
      teacher: "Nanzadragchaa",
      day: "Friday",
      startTime: "12:40",
      endTime: "15:05",
      type: "Seminar",
    },
  ],
  [
    //Nyagtlan bodoh burtgeliin undes
    {
      name: "Nyagtlan bodoh burtgeliin undes",
      teacher: "Purewdorj",
      day: "Monday",
      startTime: "09:20",
      endTime: "10:50",
      type: "Seminar",
    },
    {
      name: "Nyagtlan bodoh burtgeliin undes",
      teacher: "Purewdorj",
      day: "Monday",
      startTime: "11:45",
      endTime: "14:10",
      type: "Seminar",
    },
    {
      name: "Nyagtlan bodoh burtgeliin undes",
      teacher: "Purewdorj",
      day: "Thursday",
      startTime: "07:40",
      endTime: "09:10",
      type: "Lecture",
    },
    {
      name: "Nyagtlan bodoh burtgeliin undes",
      teacher: "Purewdorj",
      day: "Thursday",
      startTime: "09:20",
      endTime: "10:50",
      type: "Lecture",
    },
    {
      name: "Nyagtlan bodoh burtgeliin undes",
      teacher: "Purewdorj",
      day: "Thursday",
      startTime: "11:45",
      endTime: "14:10",
      type: "Lecture",
    },
    {
      name: "Nyagtlan bodoh burtgeliin undes",
      teacher: "Purewdorj",
      day: "Thursday",
      startTime: "14:20",
      endTime: "16:45",
      type: "Lecture",
    },
    {
      name: "Nyagtlan bodoh burtgeliin undes",
      teacher: "Damdindorj",
      day: "Friday",
      startTime: "16:00",
      endTime: "18:25",
      type: "Seminar",
    },
  ],
  [
    //Web programming
    {
      name: "Web programming",
      teacher: "Uitumen",
      day: "Monday",
      startTime: "14:20",
      endTime: "15:50",
      type: "Lecture",
    },
    {
      name: "Web programming",
      teacher: "Uitumen",
      day: "Monday",
      startTime: "16:45",
      endTime: "19:10",
      type: "Laboratory",
    },
    {
      name: "Web programming",
      teacher: "Uitumen",
      day: "Thursday",
      startTime: "10:05",
      endTime: "12:30",
      type: "Laboratory",
    },
    {
      name: "Web programming",
      teacher: "Amarsanaa",
      day: "Tuesday",
      startTime: "11:00",
      endTime: "12:30",
      type: "Lecture",
    },
    {
      name: "Web programming",
      teacher: "Amarsanaa",
      day: "Wednesday",
      startTime: "15:05",
      endTime: "17:30",
      type: "Laboratory",
    },
    {
      name: "Web programming",
      teacher: "Amarsanaa",
      day: "Wednesday",
      startTime: "17:40",
      endTime: "20:05",
      type: "Laboratory",
    },
    {
      name: "Web programming",
      teacher: "Amarsanaa",
      day: "Wednesday",
      startTime: "15:05",
      endTime: "17:30",
      type: "Lecture",
    },
    {
      name: "Web programming",
      teacher: "Uitumen",
      day: "Thursday",
      startTime: "12:40",
      endTime: "14:10",
      type: "Lecture",
    },
    {
      name: "Web programming",
      teacher: "Uitumen",
      day: "Tuesday",
      startTime: "16:00",
      endTime: "18:20",
      type: "Laboratory",
    },
    {
      name: "Web programming",
      teacher: "Uitumen",
      day: "Tuesday",
      startTime: "18:25",
      endTime: "20:50",
      type: "Laboratory",
    },
  ],
  [
    //Data structures
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Monday",
      startTime: "07:40",
      endTime: "09:10",
      type: "Lecture",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Monday",
      startTime: "09:20",
      endTime: "10:50",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Tuesday",
      startTime: "14:20",
      endTime: "15:50",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Tuesday",
      startTime: "09:20",
      endTime: "10:50",
      type: "Lecture",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Tuesday",
      startTime: "07:40",
      endTime: "09:10",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Tuesday",
      startTime: "11:00",
      endTime: "12:30",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Tuesday",
      startTime: "12:40",
      endTime: "14:10",
      type: "Lecture",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Friday",
      startTime: "07:40",
      endTime: "09:10",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Friday",
      startTime: "09:20",
      endTime: "10:50",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Magsarjaw",
      day: "Wednesday",
      startTime: "12:40",
      endTime: "14:10",
      type: "Lecture",
    },
    {
      name: "Data structures",
      teacher: "Magsarjaw",
      day: "Wednesday",
      startTime: "09:20",
      endTime: "10:50",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Magsarjaw",
      day: "Wednesday",
      startTime: "11:00",
      endTime: "12:30",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Thursday",
      startTime: "16:00",
      endTime: "17:30",
      type: "Lecture",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Thursday",
      startTime: "17:40",
      endTime: "19:10",
      type: "Seminar",
    },
    {
      name: "Data structures",
      teacher: "Bagabold",
      day: "Thursday",
      startTime: "19:20",
      endTime: "20:50",
      type: "Seminar",
    },
  ],
];

function generateSchedules(subjects, currentSchedule = [], allSchedules = []) {
  if (subjects.length === 0) {
    allSchedules.push(currentSchedule);
    return;
  }

  const [currentSubject, ...remainingSubjects] = subjects;

  const lectures = currentSubject.filter((s) => s.type === "Lecture");
  const seminarsOrLabs = currentSubject.filter((s) => s.type !== "Lecture");

  const combinations = [];

  for (const lecture of lectures) {
    if (seminarsOrLabs.length == 0) {
      //Gamshig, Medeelliin systemiin undes etc.
      combinations.push([lecture, []]);
      // console.log("debug1", lecture);
    } else {
      for (const seminarOrLab of seminarsOrLabs) {
        if (!overlap(lecture, seminarOrLab)) {
          combinations.push([lecture, seminarOrLab]);
        }
      }
    }
  }

  let subjectAdded = false;

  for (const combination of combinations) {
    if (
      !combination.some((session) =>
        currentSchedule.some((s) => overlap(s, session))
      )
    ) {
      subjectAdded = true;
      generateSchedules(
        remainingSubjects,
        [...currentSchedule, ...combination],
        allSchedules
      );
    }
  }

  // if (!subjectAdded) {
  generateSchedules(remainingSubjects, currentSchedule, allSchedules);
  // }

  return allSchedules;
}

const days = [
  "Monday",
  "Tuesday",
  "Wednesday",
  "Thursday",
  "Friday",
  "Saturday",
  "Sunday",
];
function printSchedule(schedule) {
  const scheduleByDay = {};

  for (const item of schedule) {
    if (!scheduleByDay[item.day]) {
      scheduleByDay[item.day] = [];
    }
    scheduleByDay[item.day].push(item);
  }

  for (const day of days) {
    if (scheduleByDay[day]) {
      console.log(day);
      for (const item of scheduleByDay[day]) {
        console.log(
          `  ${item.name} (${item.type}): ${item.startTime}-${item.endTime} (${item.teacher})`
        );
      }
    }
  }

  console.log("---");
}

function overlap(a, b) {
  return (
    a.day === b.day &&
    ((a.startTime >= b.startTime && a.startTime < b.endTime) ||
      (a.endTime > b.startTime && a.endTime <= b.endTime))
  );
}

module.exports = generateSchedules;

var startTime = performance.now();
const allSchedules = generateSchedules(Subjects);
allSchedules.sort((a, b) => a.length - b.length);
// allSchedules.forEach(printSchedule);
printSchedule(allSchedules[100000]);
var endTime = performance.now();
// allSchedules.forEach((schedule) => console.table(schedule));
console.log(allSchedules.length);

console.log(`Call to doSomething took ${endTime - startTime} milliseconds`);

let tmp = [];
allSchedules[0].forEach((element) => {
  tmp.push(element);
});
console.table(tmp);

let tmp1 = [];
allSchedules[100].forEach((element) => {
  tmp1.push(element);
});
console.table(tmp1);

let tmp2 = [];
allSchedules[1000].forEach((element) => {
  tmp2.push(element);
});
console.table(tmp2);

let tmp3 = [];
allSchedules[10000].forEach((element) => {
  tmp3.push(element);
});
console.table(tmp3);

let tmp4 = [];
allSchedules[allSchedules.length - 1].forEach((element) => {
  tmp3.push(element);
});
console.table(tmp3);
